---
title: "Bootstrap"
format: html
editor: visual
---

## Load implementations

```{r}
library(magrittr)
source("../load_data.R")
source("../implementations.R")
```

## Load Data and Models

```{r}
dataset <- import_data()
CIR_fn <- CIR_functions()
L_CIR_fn <- Lamperti_CIR_functions()
DW_fn <- DW_functions()
```

## Estimation Test

```{r}
optim(
  par = L_CIR_fn$inverse_transform(martingale(dataset$Ca2, 0.02)),
  fn = lie_trotter,
  fs = L_CIR_fn,
  dt = 0.02,
  x = dataset$Y,
  control = list(
    reltol = sqrt(.Machine$double.eps) / 1e8,
    maxit = 1000L
  ),
  method = "BFGS"
) %>% 
  magrittr::extract2("par") %>% 
  CIR_fn$transform()
```

## Simulation Test

```{r}
test <- rmilstein(
  CIR_fn$inverse_transform(martingale(dataset$Ca2, 0.02)),
  x0 = dataset$Ca2[1],
  t0 = 23,
  t1 = 93,
  dt = 0.001,
  fs = CIR_fn
) %>% 
  # {.^2 / 2} %>% 
  data.frame(x = ., t = seq(23, 93, 0.001))
```

```{r}
library(ggplot2)
test[seq(1, nrow(test), 100), ] %>% 
  ggplot(aes(x = t, y = x)) +
  geom_path() +
  ggplot2::theme_bw()
```
