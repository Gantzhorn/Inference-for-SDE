---
title: "Bootstrap"
format: html
editor: visual
---

## Load implementations

```{r}
library(magrittr)
source("../load_data.R")
source("../implementations.R")
```

## Load Data and Models

```{r}
dataset <- import_data()
CIR_fn <- CIR_functions()
L_CIR_fn <- Lamperti_CIR_functions()
DW_fn <- DW_functions()
```

## Estimation Test

```{r}
optim(
  par = L_CIR_fn$inverse_transform(martingale(dataset$Ca2, 0.02)),
  fn = lie_trotter,
  fs = L_CIR_fn,
  dt = 0.02,
  x = dataset$Y,
  control = list(
    reltol = sqrt(.Machine$double.eps) / 1e8,
    maxit = 1000L
  ),
  method = "BFGS"
) %>% 
  magrittr::extract2("par") %>% 
  CIR_fn$transform()
```

## Simulation Test

```{r}
rlie_trotter(
  L_CIR_fn$inverse_transform(martingale(dataset$Ca2, 0.02)),
  x0 = dataset$Y[1],
  t0 = 23,
  t1 = 93,
  dt = 0.02,
  fs = L_CIR_fn
) %>% {.^2 / 2}
```
